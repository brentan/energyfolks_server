<div id='EnergyFolksAffiliatePicker'>
  <%
     send_to_all = current.map { |a| a.affiliate_id }.include?(0)
  %>
  <% if table != 'user' %>
    <div class='form_entry'>
      <input id='send_to_all_yes' type=radio name='send_to_all' value=1 class='toggle' <%= send_to_all ? 'checked' : '' %>>
      <label for="send_to_all_yes">Send to All <%= Affiliate.all.count() %> Energyfolks Affiliates</label><BR>
      <h2>OR</h2>
      <input id='send_to_all_no' type=radio name='send_to_all' value=0 class='toggle' <%= !send_to_all ? 'checked' : '' %>>
      <label for="send_to_all_no">Choose Networks Individually</label>
    </div>
  <% end %>

  <div id='choose_affiliates' class='form_entry' <%= send_to_all ? 'style="display:none;"' : '' %>>
      <%= content_tag(:h1, "Current Networks") if (current.length > 0) && !((current.length == 1) && (current[0].affiliate_id == 0)) %>
      <% count = 0
         completed = current.map{|c| c.affiliate_id }
         current.each do |a| %>
          <% if a.affiliate_id == 0 %>
              <div class='affiliate_0' <%= "data-name='Energyfolks' data-tid=#{a.id.present? ? a.id : 0} data-table=#{table} data-join-table=#{join_table} data-id=#{a.affiliate_id} data-jid=#{count} data-reason=#{false}"%> style='display:none;'></div>
          <% else %>
              <div class='affiliate selected' <%= "data-name=#{a.affiliate.name} data-override-all=#{completed.include?(0)} data-tid=#{a.id.present? ? a.id : 0} data-table=#{table} data-join-table=#{join_table} data-id=#{a.affiliate_id} data-jid=#{count} data-reason=#{false}"%> >
                <%= a.affiliate.name %>
                <div class="affiliate-details">
                  <div class="affiliate-FAQs">
                    <div class="affiliate-FAQs-title">Quick FAQs</div>
                    <div class="affiliate-FAQs-label">Date Founded</div>
                    <div><%= a.affiliate.year_founded %></div>
                    <div class="affiliate-FAQs-label">Total Members</div>
                    <div><%= Membership.find_all_by_affiliate_id(a.affiliate.id).count %></div>
                    <div class="affiliate-FAQs-label">President</div>
                    <div><%= a.affiliate.president_name %></div>
                  </div>
                  <%= a.affiliate.description %>
                </div>
                <%= raw(" <span class='descriptor'>#{a.approved? ? '' : "(Pending#{a.reason.present? ? ", #{a.reason}" : ''})"}</span>") %>
              </div>
          <% end %>
          <% count += 1 %>
      <% end
         if !completed.include?(0) %>
        <div class='affiliate_0' <%= "data-name='Energyfolks' data-tid=0 data-table=#{table} data-join-table=#{join_table} data-id=0 data-jid=#{count} data-reason=#{false}"%> style='display:none;'></div>
      <% end %>
      <% if (current.length - (completed.include?(0) ? 1 : 0) - Affiliate.all_visible_affiliates(current_user, current_affiliate, table == 'user').length) < 0 %>
        <%
          completed = current.map{|c| c.affiliate_id }
          Affiliate.all_visible_affiliates(current_user, current_affiliate, table == 'user').each do |a|
            next if completed.include? a.id %>
            <div class='affiliate unselected' <%= "data-name=#{a.name} data-tid=0 data-table=#{table} data-join-table=#{join_table} data-id=#{a.id} data-jid=#{count} data-reason=#{table == 'user' ? (a.open > 1) : false}"%> >
              <%= a.name %>
              <div class="affiliate-details">
                <div class="affiliate-FAQs">
                  <div class="affiliate-FAQs-title">Quick FAQs</div>
                  <div class="affiliate-FAQs-label">Date Founded</div>
                  <div><%= a.year_founded %></div>
                  <div class="affiliate-FAQs-label">Total Members</div>
                  <div><%= Membership.find_all_by_affiliate_id(a.id).count %></div>
                  <div class="affiliate-FAQs-label">President</div>
                  <div><%= a.president_name %></div>
                </div>
                <%= a.description %>
              </div>
              <span class='descriptor'></span>
              <% count += 1 %>
            </div>
          <% end %>
      <% end %>
  </div>
  <%= raw(table == 'user' ? f.hidden_field(:affiliate_id) : '<input type=hidden value=0 id=user_affiliate_id>') %>
  <div id='primary_affiliate' <%= table != 'user' ? 'style=display:none;' : '' %>>
  </div>
  <div id='form_elements' style='display:none;'></div>
</div>